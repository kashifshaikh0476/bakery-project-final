{% extends 'base.html' %}
{% load static %}

{% block content %}

<style>
    /* Stats Cards Styling */
    .stats-container {
        display: flex; gap: 20px; margin-bottom: 30px; flex-wrap: wrap;
    }
    .stat-card {
        flex: 1; min-width: 250px; background: #fff; padding: 20px;
        border-radius: 15px; border-left: 5px solid #D4AF37;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        display: flex; align-items: center; justify-content: space-between;
    }
    .stat-number { font-size: 2.2rem; font-weight: bold; color: #2C2C2C; }
    .stat-label { color: #777; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; }
    
    .admin-table-container {
        background: #fff; border-radius: 15px; overflow: hidden;
        border: 1px solid #eee; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }

    /* === Dropdown and Tick Centering Logic === */
    .status-form-wrapper {
        display: flex;
        align-items: center;
        justify-content: center; /* Centers the whole block in the cell */
        gap: 10px;
        width: 100%;
    }

    /* Making Dropdown Box Visible as requested */
    .admin-status-select {
        display: block !important; 
        width: 150px !important; 
        height: 38px !important;
        background-color: #ffffff !important; 
        border: 2px solid #D4AF37 !important; /* Gold Border */
        border-radius: 8px !important; 
        color: #333 !important; 
        padding: 0 8px !important;
        font-weight: 600 !important;
        cursor: pointer !important;
    }

    /* Centered Tick Button */
    .btn-update-tick {
        background-color: #D4AF37 !important;
        width: 38px !important;
        height: 38px !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        border-radius: 50% !important;
        flex-shrink: 0;
    }
</style>

<div class="dashboard-container" style="padding: 40px 5%; max-width: 1400px; margin: 0 auto;">
    
    <div class="dashboard-header" style="text-align: center; margin-bottom: 40px;">
        <h1 style="font-family: 'Playfair Display', serif; color: #D4AF37; font-size: 3rem;">
            Admin Dashboard <span style="font-size: 2rem;">ðŸ‘‘</span>
        </h1>
        <p style="color: #777;">Monitor and manage all A1 Bakery orders</p>
    </div>

    <div class="stats-container">
        <div class="stat-card">
            <div>
                <div class="stat-number">{{ total_orders }}</div>
                <div class="stat-label">Total Orders</div>
            </div>
            <div style="font-size: 2.5rem;"><i class="fas fa-shopping-bag" style="color: #D4AF37;"></i></div>
        </div>

        <div class="stat-card" style="border-left-color: #ff9800;">
            <div>
                <div class="stat-number" style="color: #ff9800;">{{ pending_count }}</div>
                <div class="stat-label">Pending</div>
            </div>
            <div style="font-size: 2.5rem;"><i class="fas fa-clock" style="color: #ffe0b2;"></i></div>
        </div>

        <div class="stat-card" style="border-left-color: #4CAF50;">
            <div>
                <div class="stat-number" style="color: #4CAF50;">â‚¹ {{ revenue }}</div>
                <div class="stat-label">Total Revenue</div>
            </div>
            <div style="font-size: 2.5rem;"><i class="fas fa-rupee-sign" style="color: #c8e6c9;"></i></div>
        </div>
    </div>

    <div class="admin-table-container">
        <table class="highlight responsive-table" style="width: 100%;">
            <thead style="background-color: #2C2C2C; color: #D4AF37;">
                <tr>
                    <th style="padding: 20px;">ID</th>
                    <th>Customer Details</th>
                    <th>Product & Qty</th>
                    <th>Address</th>
                    <th style="text-align: center;">Status Update</th>
                    <th style="text-align: center;">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %} 
                <tr style="border-bottom: 1px solid #f1f1f1;">
                    <td style="padding: 20px; font-weight: bold; color: #999;">#{{ order.id }}</td>
                    <td>
                        <div style="font-weight: bold; color: #2C2C2C;">{{ order.customer_name }}</div>
                        <div style="font-size: 0.85rem; color: #777;">{{ order.customer_phone }}</div>
                    </td>
                    <td>
                        {% if order.product %}
                            <span style="color: #D4AF37; font-weight: 600;">{{ order.product.name }}</span>
                            <br><span style="font-size: 0.8rem; color: #555;">Quantity: {{ order.quantity }}</span>
                        {% else %}
                            <span style="color: red;">No Product</span>
                        {% endif %}
                    </td>
                    <td>
                        <span style="font-size: 0.85rem; color: #666;">{{ order.address|truncatechars:35 }}</span>
                    </td>
                    
                    <td style="text-align: center;">
                        <form action="{% url 'status' order.id %}" method="POST" style="margin: 0;">
                            {% csrf_token %}
                            <div class="status-form-wrapper">
                                <select name="status" class="browser-default admin-status-select">
                                    <option value="Pending" {% if order.status == 'Pending' %}selected{% endif %}>Pending</option>
                                    <option value="In Progress" {% if order.status == 'In Progress' %}selected{% endif %}>Cooking</option>
                                    <option value="Shipped" {% if order.status == 'Shipped' %}selected{% endif %}>Shipped</option>
                                    <option value="Ready For Pickup" {% if order.status == 'Ready For Pickup' %}selected{% endif %}>Ready</option>
                                    <option value="Delivered" {% if order.status == 'Delivered' %}selected{% endif %}>Delivered</option>
                                </select>
                                
                                <button type="submit" class="btn-floating btn-update-tick waves-effect waves-light">
                                    <i class="fas fa-check"></i>
                                </button>
                            </div>
                        </form>
                    </td>

                    <td style="padding: 20px; text-align: center;">
                        <a href="{% url 'detail' order.id %}" class="btn-small" style="background-color: #2C2C2C; border-radius: 20px; color: #D4AF37;">VIEW</a>
                    </td>
                </tr>
                {% empty %}
                <tr><td colspan="6" style="text-align: center; padding: 50px; color: #999;">No active orders found.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% endblock %}
