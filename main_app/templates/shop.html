{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* Google Fonts */
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600;700&display=swap');

    /* === 1. NEW DARK LUXURY BACKGROUND === */
    body {
        font-family: 'Poppins', sans-serif;
        background-color: #1a1a1a; /* Dark Background */
        background-image: radial-gradient(#333 1px, transparent 1px);
        background-size: 30px 30px; /* Subtle texture */
        color: #f0f0f0;
    }

    /* === HERO HEADER === */
    .header-hero {
        background-image: url("https://static.vecteezy.com/system/resources/thumbnails/050/501/529/small/black-steel-countertop-shelf-with-spotlight-and-brown-wall-for-product-display-promotion-photo.JPG");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        position: relative;
        padding: 100px 20px 120px;
        text-align: center;
        margin-bottom: -60px;
        z-index: 1;
        border-bottom: 3px solid #D4AF37; /* Gold separator line */
    }

    .header-hero::before {
        content: "";
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        z-index: -1;
    }

    .hero-title {
        font-family: 'Playfair Display', serif;
        font-size: 3.5rem;
        color: #fff;
        margin: 0;
        text-shadow: 2px 2px 10px rgba(0,0,0,0.8);
    }

    .hero-subtitle {
        color: #ccc;
        font-size: 1.2rem;
        margin-top: 10px;
        font-weight: 300;
        letter-spacing: 1px;
    }

    .crown-icon { font-size: 30px; color: #D4AF37; margin-bottom: 15px; display: block; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
    .gold-accent { color: #D4AF37; font-weight: 700; }


    /* === 2. DARK BORDER & SHADOW CARDS === */
    .shop-grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
        gap: 40px;
        padding: 0 5% 100px;
        max-width: 1400px;
        margin: 0 auto;
        position: relative;
        z-index: 2;
    }

    .pro-card {
        background: #ffffff;
        border-radius: 20px;
        border: 2px solid #2c2c2c;
        box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    .pro-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 25px 50px rgba(212, 175, 55, 0.3);
        border-color: #D4AF37;
    }

    .img-box {
        height: 250px; width: 100%; background: #f4f4f4; position: relative; cursor: pointer; overflow: hidden;
        border-bottom: 2px solid #2c2c2c;
    }
    .cake-photo { width: 100%; height: 100%; object-fit: cover; transition: transform 0.5s ease; }
    .pro-card:hover .cake-photo { transform: scale(1.08); }
    
    .fresh-badge { 
        position: absolute; top: 10px; left: 10px; 
        background: #2c2c2c; color: #fff; 
        padding: 4px 12px; border-radius: 20px; 
        font-size: 0.7rem; font-weight: bold; 
        box-shadow: 0 2px 5px rgba(0,0,0,0.3); z-index: 2; 
    }

    .info-section { padding: 25px 20px; flex-grow: 1; display: flex; flex-direction: column; }
    
    .product-name { 
        font-size: 1.5rem; color: #1a1a1a; 
        margin: 0 0 5px; font-weight: 700; 
        font-family: 'Playfair Display', serif; 
    }
    
    .card-footer { 
        margin-top: auto; display: flex; justify-content: space-between; 
        align-items: center; padding-top: 15px; 
        border-top: 1px dashed #aaa; 
    }
    
    .price-tag { font-size: 1.4rem; color: #1a1a1a; font-weight: 800; }
    
    .add-btn { 
        width: 50px; height: 50px; 
        background: #D4AF37; color: white; 
        border-radius: 50%; display: flex; 
        align-items: center; justify-content: center; 
        font-size: 24px; text-decoration: none; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.2); 
        transition: 0.3s; 
    }
    .add-btn:hover { background: #1a1a1a; transform: scale(1.1) rotate(90deg); }

    .admin-row { margin-top: 10px; font-size: 0.75rem; text-align: right; }

    /* Modal Styles */
    .modal-overlay { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.8); backdrop-filter: blur(5px); align-items: center; justify-content: center; }
    .modal-content { background-color: #fff; margin: 5% auto; padding: 0; border-radius: 20px; width: 90%; max-width: 850px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); position: relative; display: flex; flex-wrap: wrap; overflow: hidden; animation: modalFadeIn 0.4s; border: 2px solid #D4AF37; }
    @keyframes modalFadeIn { from {opacity: 0; transform: scale(0.9);} to {opacity: 1; transform: scale(1);} }
    .close-modal { color: #333; position: absolute; top: 20px; right: 25px; font-size: 40px; font-weight: 300; transition: 0.3s; z-index: 10; cursor: pointer; line-height: 1; }
    .close-modal:hover { color: #D4AF37; transform: rotate(90deg); }
    .modal-img-box { flex: 1 1 450px; height: 500px; background: #eee; }
    .modal-img-box img { width: 100%; height: 100%; object-fit: cover; }
    .modal-details { flex: 1 1 350px; padding: 50px 40px; display: flex; flex-direction: column; justify-content: center; }
    #modalTitle { font-family: 'Playfair Display', serif; font-size: 2.5rem; margin-top: 0; color: #333; line-height: 1.2; }
    #modalDesc { color: #666; line-height: 1.8; font-size: 1rem; margin: 20px 0 30px; }
    .modal-footer-row { margin-top: auto; display: flex; align-items: center; justify-content: space-between; }
    #modalPrice { font-size: 2rem; font-weight: 800; color: #D4AF37; }
    .modal-add-btn { padding: 15px 40px; background: #D4AF37; color: white; border-radius: 50px; text-decoration: none; font-weight: bold; letter-spacing: 1px; box-shadow: 0 10px 25px rgba(212, 175, 55, 0.4); transition: 0.3s; }
    .modal-add-btn:hover { background: #1a1a1a; box-shadow: 0 5px 15px rgba(0,0,0,0.4); transform: translateY(-3px); }

</style>

<div class="header-hero">
    <span class="crown-icon">♛</span>
    <h1 class="hero-title">The <span class="gold-accent">A1</span> Special Menu</h1>
    <p class="hero-subtitle">Premium handcrafted cakes displayed in the spotlight.</p>
</div>

<div class="shop-grid-container">
    {% for product in products %}
    <div class="pro-card">
        <div class="img-box quick-view-trigger" 
             data-name="{{ product.name }}"
             data-price="{{ product.price }}"
             data-desc="{{ product.description }}"
             data-url="{% url 'create_order' product.id %}" 
             {% if product.image %} data-img="{{ product.image.url }}" {% endif %}>
             
            <span class="fresh-badge">Quick View</span>
            {% if product.image %}
                <img src="{{ product.image.url }}" class="cake-photo" alt="{{ product.name }}">
            {% else %}
                <div style="height: 100%; display: flex; align-items: center; justify-content: center; color: #ccc;">No Image</div>
            {% endif %}
        </div>

        <div class="info-section">
            <h3 class="product-name">{{ product.name }}</h3>
            
            <div class="card-footer">
                <span class="price-tag">₹ {{ product.price }}</span>
                <a href="{% url 'create_order' product.id %}" class="add-btn" title="Add to Cart">+</a>
            </div>

            {% if user.is_superuser %}
            <div class="admin-row">
                <a href="/admin/main_app/product/{{ product.id }}/change/" style="color: #2196F3; margin-right: 10px;">EDIT</a>
                <a href="/admin/main_app/product/{{ product.id }}/delete/" style="color: #F44336;">DELETE</a>
            </div>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div style="grid-column: 1/-1; text-align: center; padding: 50px; background: #222; border-radius: 15px; border: 1px solid #444;">
        <h3 style="color: #ccc;">No products available right now.</h3>
    </div>
    {% endfor %}
</div>

<div id="quickViewModal" class="modal-overlay">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <div class="modal-img-box"><img id="modalImg" src="" alt="Cake"></div>
        <div class="modal-details">
            <h2 id="modalTitle"></h2>
            <p id="modalDesc"></p>
            <div class="modal-footer-row">
                 <span id="modalPrice"></span>
                 <a href="#" id="modalAddBtn" class="modal-add-btn">ADD TO CART</a>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('quickViewModal');
        const closeModalBtn = document.querySelector('.close-modal');
        const modalImg = document.getElementById('modalImg');
        const modalTitle = document.getElementById('modalTitle');
        const modalDesc = document.getElementById('modalDesc');
        const modalPrice = document.getElementById('modalPrice');
        const modalAddBtn = document.getElementById('modalAddBtn'); // Select the button

        document.querySelectorAll('.quick-view-trigger').forEach(trigger => {
            trigger.addEventListener('click', function() {
                modalTitle.textContent = this.dataset.name;
                modalPrice.textContent = '₹ ' + this.dataset.price;
                modalDesc.textContent = this.dataset.desc;
                modalImg.src = this.dataset.img || 'https://via.placeholder.com/400x450.png?text=No+Image';
                
                // === VITAL FIX: Set dynamic URL for Modal Button ===
                modalAddBtn.href = this.dataset.url; 
                
                modal.style.display = "flex";
            });
        });
        closeModalBtn.onclick = () => modal.style.display = "none";
        window.onclick = (e) => { if (e.target == modal) modal.style.display = "none"; }
    });
</script>

{% endblock %}
